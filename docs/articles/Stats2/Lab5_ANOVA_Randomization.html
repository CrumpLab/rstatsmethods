<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lab 5 ANOVA and Randomization • psyc7709Lab</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Lab 5 ANOVA and Randomization">
<meta property="og:description" content="psyc7709Lab">
<meta property="og:image" content="https://crumplab.github.io/psyc7709Lab/logo.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@MattCrump_">
<meta name="twitter:site" content="@MattCrump_">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-79429674-12"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-79429674-12');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">psyc7709Lab</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9004</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Syllabus
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/course_docs/Spring_syllabus.html">Spring 2021</a>
    </li>
    <li>
      <a href="../../articles/course_docs/Syllabus.html">Fall 2020</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">STATS 2 Spring 2021</li>
    <li>
      <a href="../../articles/Stats2/Lab1_Shape.html">Lab 1 Shaping Data</a>
    </li>
    <li>
      <a href="../../articles/Stats2/Lab2_Multiple_regression_I.html">Lab 2 Multiple Regression</a>
    </li>
    <li>
      <a href="../../articles/Stats2/Lab3_Multiple_regression_II.html">Lab 3 Multiple Regression II</a>
    </li>
    <li>
      <a href="../../articles/Stats2/Lab4_ANOVA.html">Lab 4 ANOVA</a>
    </li>
    <li>
      <a href="../../articles/Stats2/Lab5_ANOVA_Randomization.html">Lab 5 ANOVA and Randomization</a>
    </li>
    <li>
      <a href="../../articles/Stats2/Lab6_Comparisons.html">Lab 6 Comparisons</a>
    </li>
    <li>
      <a href="../../articles/Stats2/Lab7_Factorial_ANOVA.html">Lab 7 Factorial ANOVA</a>
    </li>
    <li>
      <a href="../../articles/Stats2/Lab8_Contrasts.html">Lab 8 Contrast Analyses</a>
    </li>
    <li>
      <a href="../../articles/Stats2/Lab9_RM_ANOVA.html">Lab 9 RM ANOVA</a>
    </li>
    <li>
      <a href="../../articles/Stats2/Lab10_Nested_Designs.html">Lab 10 Nested Designs</a>
    </li>
    <li>
      <a href="../../articles/Stats2/Lab11_WYOR.html">Lab 11 WYOR</a>
    </li>
    <li class="dropdown-header">STATS 1 FALL 2020</li>
    <li>
      <a href="../../articles/Stats1/Getting_Started.html">Getting Started</a>
    </li>
    <li>
      <a href="../../articles/Stats1/Lab1_Basics.html">Lab 1 Basics</a>
    </li>
    <li>
      <a href="../../articles/Stats1/Lab2_Descriptives.html">Lab 2 Descriptives</a>
    </li>
    <li>
      <a href="../../articles/Stats1/Lab3_Distributions_I.html">Lab 3 Distributions I</a>
    </li>
    <li>
      <a href="../../articles/Stats1/Lab4_Distributions_II.html">Lab 4 Distributions II</a>
    </li>
    <li>
      <a href="../../articles/Stats1/Lab5_Sampling_Distributions.html">Lab 5 Sampling Distributions</a>
    </li>
    <li>
      <a href="../../articles/Stats1/Lab6_Statistical_Inference.html">Lab 6 Statistical Inference</a>
    </li>
    <li>
      <a href="../../articles/Stats1/Lab7_Binomial.html">Lab 7 Binomial tests</a>
    </li>
    <li>
      <a href="../../articles/Stats1/Lab8_Normal.html">Lab 8 Z tests</a>
    </li>
    <li>
      <a href="../../articles/Stats1/Lab9_Chisquare.html">Lab 9 Chi Square</a>
    </li>
    <li>
      <a href="../../articles/Stats1/Lab10_ttest.html">Lab 10 t tests</a>
    </li>
    <li>
      <a href="../../articles/Stats1/SP_Power.html">Simulation and Power analysis I</a>
    </li>
    <li>
      <a href="../../articles/Stats1/Lab11_Correlation.html">Lab 11 Correlation</a>
    </li>
    <li>
      <a href="../../articles/Stats1/Lab12_Regression.html">Lab 12 Regression</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    R Reference
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/course_docs/reference_code.html">Coding Reference</a>
    </li>
    <li>
      <a href="../../articles/course_docs/resources.html">More resources</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Semester Project
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/Stats2/semester_project.html">Spring 2021</a>
    </li>
    <li>
      <a href="../../articles/Stats1/semester_project.html">Fall 2020</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../articles/course_docs/contribute.html">Extra Credit</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/CrumpLab/psyc7709Lab">
    <span class="fas fa-lg fa-github"></span>
     
  </a>
</li>
<li>
  <a href="../../news/index.html">news</a>
</li>
<li>
  <a href="../../reference/index.html"></a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Lab5_ANOVA_Randomization_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Lab 5 ANOVA and Randomization</h1>
                        <h4 class="author">Matthew J. C. Crump</h4>
            
            <h4 class="date">3/5/2021</h4>
      
      
      <div class="hidden name"><code>Lab5_ANOVA_Randomization.Rmd</code></div>

    </div>

    
    
<div id="reading" class="section level2">
<h2 class="hasAnchor">
<a href="#reading" class="anchor"></a>Reading</h2>
<p>Chapters 9 and 10 from <span class="citation">(<a href="#ref-abdiExperimentalDesignAnalysis2009" role="doc-biblioref">Abdi et al., 2009</a>)</span>.</p>
</div>
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>Simulating the Null and Randomization test</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/3a0OHVuxoMI" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>Alternative Hypotheses</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/b54D5Ryc_xk" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>Throughout this course we reiterate that ANOVA and regression are fundamentally the same analysis. For example, the readings from the textbook for this week show ANOVA from a linear regression perspective. The purpose of this lab is to develop another similarity, between ANOVA and randomization/permutation tests (remember we discussed these last semester in <a href="https://crumplab.github.io/psyc7709Lab/articles/Stats1/Lab6_Statistical_Inference.html">lab 6</a>). The plan for the lab is to walk through the conceptual issues involved in detecting causal influences from experiments with one independent variable and multiple levels. We will see how ANOVA is one approach to detecting causal influences. In this lab we will attempt to expose the assumptions made in ANOVA, and also show how Randomization tests could be employed as a non-parametric alternative (a test that doesn’t depend on the assumptions inherent to ANOVA).</p>
</div>
<div id="how-can-you-know-if-your-experiment-works" class="section level2">
<h2 class="hasAnchor">
<a href="#how-can-you-know-if-your-experiment-works" class="anchor"></a>How can you know if your experiment works?</h2>
<p>You are planning to run a between-subjects experiment with one independent variable that has multiple levels (let’s say four). As an experimenter, you are interested in whether the manipulation (your IV) causes a change in your measurement (your DV). You will assign subjects randomly to each of the levels of your IV, and you will take measurements of subject performance in each of the levels. Then, you will look at means in each level.</p>
<p>If some aspect of your manipulation causally changes the means in your measurement (DV), then you will expect to find some differences in means between the levels. However, because you are randomly assigning different subjects to the different levels, you also know that you will find differences between the means as a result of the error introduced by the random assignment process. Thus, you consider the role of chance in producing differences in your measurements as a part of your inferential process for determining whether experiment had a causal influence.</p>
</div>
<div id="constructing-a-null-hypothesis" class="section level2">
<h2 class="hasAnchor">
<a href="#constructing-a-null-hypothesis" class="anchor"></a>Constructing a null-hypothesis</h2>
<p>Last lab we walked through the details of the pieces of ANOVA, including how the F-ratio is computed directly from the data. Remember, the formula for F is:</p>
<p><span class="math inline">\(F = \frac{MS_{between}}{MS_{within}}\)</span></p>
<p><span class="math inline">\(MS_{between}\)</span> is a variance representing the average differences between the levels in your independent variable. This number should grow larger as the differences between means across your levels grows larger. <span class="math inline">\(MS_{within}\)</span> is a variance representing the average differences among subjects inside each level. If we assume that that your manipulation does not change these random differences between subjects, then this variance should roughly be the same regardless of whether your manipulation causes a change in the means.</p>
<p>The <span class="math inline">\(F\)</span>-ratio itself is a summary statistic of the data. <span class="math inline">\(F\)</span> will tend to get larger than 1 when the experimental manipulation actually causes a difference in means between the levels. This is because the numerator <span class="math inline">\(MS_{between}\)</span>, will tend to be much larger than the denominator <span class="math inline">\(MS_{within}\)</span>. At the same time, <span class="math inline">\(F\)</span> can take on a range values just by random chance too. So, a first step in our process of statistical inference will be to determine what kinds of values F can take as a result of our random assignment process. This involves constructing a sampling distribution of <span class="math inline">\(F\)</span> for the null-hypothesis of no differences between means.</p>
<div id="f-distribution" class="section level3">
<h3 class="hasAnchor">
<a href="#f-distribution" class="anchor"></a>F distribution</h3>
<p>As mentioned last class, base R provide distribution functions for <span class="math inline">\(F\)</span>, such as <code><a href="https://rdrr.io/r/stats/Fdist.html">df()</a></code>, <code><a href="https://rdrr.io/r/stats/Fdist.html">pf()</a></code>, <code><a href="https://rdrr.io/r/stats/Fdist.html">qf()</a></code>, <code><a href="https://rdrr.io/r/stats/Fdist.html">rf()</a></code>.</p>
<p>For example, we can sample random deviates from an F-distribution:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">some_F_values</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">rf</a></span>(<span class="fl">1000</span>,<span class="fl">3</span>,<span class="fl">16</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(<span class="no">some_F_values</span>)</pre></body></html></div>
<p><img src="Lab5_ANOVA_Randomization_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>And, we can compute the probability of obtaining F-values, given associated p-values.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">pf</a></span>(<span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">16</span>, <span class="kw">lower.tail</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; [1] 0.02658133</span></pre></body></html></div>
<p>These distribution functions follow from the formal analytic solutions for the F-distribution, which requires advanced calculus. The wikipedia page for the F-distribution shows some of the math involved <a href="https://en.wikipedia.org/wiki/F-distribution" class="uri">https://en.wikipedia.org/wiki/F-distribution</a>. Although this math is advanced and beyond the scope of this lab, the concept behind the math is not very advanced, and we can approximate these distributions in R using monte-carlo simulation.</p>
</div>
</div>
<div id="simulating-a-null-f-distribution-in-r" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-a-null-f-distribution-in-r" class="anchor"></a>Simulating a null F-distribution in R</h2>
<p>Before we simulate a null F-distribution in R, consider the overarching point of doing so for your experimental design. Let’s say you want to do a really good job of controlling for the error introduced by randomly assigning participants to groups. So, before you run your actual experiment, you instead run thousands of control experiments. In the control experiments, you randomly assign subjects to different groups and you measure them on your dependent variable. However, you do not conduct any manipulation at all. In this case it is impossible for your manipulation to do anything because there wasn’t one. However, you have still assigned subjects randomly to different groups. As a result, you can measure F-ratios for each of the control experiments. Sometimes by random chance you will have larger and smaller F-ratios. All of the variation in the F-ratios for your control experiments is a result of random assignment process and the fact that your dependent measure has some inherent variability. As a careful experimenter, you are interested in knowing what this control distribution of F-values looks like before you run your experiment. In other words, the null-distribution is a record of what happens across the ultimate set of control experiments (where your manipulation does nothing). If you could estimate this distribution, then when you run your experiment you could ask yourself whether you think the result you found could have happened in the control scenario (e.g., could have been something that chance did, and not your manipulation).</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tibble</span>)

<span class="co"># construct a dataframe to represent sampling random subjects into each group of the design</span>

<span class="no">levels</span> <span class="kw">&lt;-</span> <span class="fl">4</span>
<span class="no">n_per_level</span> <span class="kw">&lt;-</span> <span class="fl">5</span>

<span class="no">random_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span>(<span class="kw">subjects</span> <span class="kw">=</span> <span class="fl">1</span>:(<span class="no">levels</span>*<span class="no">n_per_level</span>),
                      <span class="kw">IV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="no">levels</span>, <span class="kw">each</span> <span class="kw">=</span> <span class="no">n_per_level</span>)),
                      <span class="kw">DV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">levels</span>*<span class="no">n_per_level</span>, <span class="fl">0</span>, <span class="fl">1</span>)
                      )

<span class="co"># compute the ANOVA and extractd the F-value</span>
<span class="no">aov.out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span>(<span class="no">DV</span> ~ <span class="no">IV</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">random_data</span>)
<span class="no">simulated_F</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">aov.out</span>)<span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">`F value`</span>[<span class="fl">1</span>]


<span class="co"># repeat the above many times to compute the F-distribution</span>
<span class="no">save_F_values</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fl">1000</span>)
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">1000</span>){
<span class="no">random_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span>(<span class="kw">subjects</span> <span class="kw">=</span> <span class="fl">1</span>:(<span class="no">levels</span>*<span class="no">n_per_level</span>),
                      <span class="kw">IV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="no">levels</span>, <span class="kw">each</span> <span class="kw">=</span> <span class="no">n_per_level</span>)),
                      <span class="kw">DV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">levels</span>*<span class="no">n_per_level</span>, <span class="fl">0</span>, <span class="fl">1</span>)
                      )
<span class="no">aov.out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span>(<span class="no">DV</span> ~ <span class="no">IV</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">random_data</span>)
<span class="no">simulated_F</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">aov.out</span>)<span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">`F value`</span>[<span class="fl">1</span>]
<span class="no">save_F_values</span>[<span class="no">i</span>] <span class="kw">&lt;-</span> <span class="no">simulated_F</span>
}</pre></body></html></div>
<p>Let’s do a quick check to see that the results we are simulating above are like the results we would get from the analytic F-distributions. The simulated distribution should converge on the analytic one as the number of iterations in the monte-carlo simulation is increased.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)

<span class="no">F_comparison</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"analytic"</span>,<span class="st">"simulated"</span>), <span class="kw">each</span> <span class="kw">=</span> <span class="fl">1000</span>),
                        <span class="kw">F_value</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">rf</a></span>(<span class="fl">1000</span>,<span class="fl">3</span>,<span class="fl">16</span>),<span class="no">save_F_values</span>))

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">F_comparison</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">F_value</span>))+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span>()+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~<span class="no">type</span>)</pre></body></html></div>
<p><img src="Lab5_ANOVA_Randomization_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div id="anova-assumptions" class="section level3">
<h3 class="hasAnchor">
<a href="#anova-assumptions" class="anchor"></a>ANOVA assumptions</h3>
<p>A major purpose of running these simulations is to find ways to inspect the underlying assumptions of ANOVA. You can see that the simulation above produced the same F-distribution as the one obtained by the analytic solution for the F-distribution.</p>
<p>The basic assumption in the simulation, which also appear in ANOVA, is that the score for each subject (that is used to compute the F-ratio) is <strong>randomly sampled from a normal distribution</strong>. In our simulation, we randomly sampled numbers for each subject from a unit normal distribution with mean = 0, and standard deviation = 1.</p>
<p>A first point to make is that the parameters in our simulated normal distribution do not influence the F-distribution. Remember, that a normal distribution has the same overall shape no matter what the mean and standard deviation is. As a result, we will always get the same F-distribution if we assume that all of our samples are coming from the same normal distribution. To illustrate the point, let’s re-run our simulation, but take values from normal distribution with mean = 50, and standard deviation = 25.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">save_new_F_values</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fl">1000</span>)
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">1000</span>){
<span class="no">random_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span>(<span class="kw">subjects</span> <span class="kw">=</span> <span class="fl">1</span>:(<span class="no">levels</span>*<span class="no">n_per_level</span>),
                      <span class="kw">IV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="no">levels</span>, <span class="kw">each</span> <span class="kw">=</span> <span class="no">n_per_level</span>)),
                      <span class="kw">DV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">levels</span>*<span class="no">n_per_level</span>, <span class="fl">50</span>, <span class="fl">25</span>)
                      )
<span class="no">aov.out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span>(<span class="no">DV</span> ~ <span class="no">IV</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">random_data</span>)
<span class="no">simulated_F</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">aov.out</span>)<span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">`F value`</span>[<span class="fl">1</span>]
<span class="no">save_new_F_values</span>[<span class="no">i</span>] <span class="kw">&lt;-</span> <span class="no">simulated_F</span>
}

<span class="no">F_comparison</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"analytic"</span>,<span class="st">"sim_0_1"</span>,<span class="st">"sim_50_25"</span>), <span class="kw">each</span> <span class="kw">=</span> <span class="fl">1000</span>),
                        <span class="kw">F_value</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">rf</a></span>(<span class="fl">1000</span>,<span class="fl">3</span>,<span class="fl">16</span>),<span class="no">save_F_values</span>, <span class="no">save_new_F_values</span>))

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">F_comparison</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">F_value</span>))+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span>()+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~<span class="no">type</span>)</pre></body></html></div>
<p><img src="Lab5_ANOVA_Randomization_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>A common term to describe the above assumption is <strong>i.i.d</strong>, which stands for independent and identically distributed. That is, we assume that each score in the data is sampled <strong>independently</strong> (or randomly) from all of the other scores, and each score is sampled from the <strong>identical</strong> distribution as all other scores. In the two simulated F-distributions above, we implemented the <strong>iid</strong> assumption both times. In one case, we sampled values from a normal with mean = 0 , and sd = 1, and the in the other we sampled scores from a normal with mean = 50, and sd = 25. As an aside, it is worth considering whether this assumption is ever true in the real world. For example, could you run a control experiment where you sample people into different groups, do no manipulation beyond assigning people to different groups, and then be confident that the mean of your measurement of each person is the same as sampling from a <strong>iid</strong> normal distribution?</p>
<p>Even though in practice we routinely violate assumptions of ANOVA, it is also the case that F-distributions are fairly resistant to violations of assumptions. For example, let’s assume that individual scores are sampled from a bimodal distribution, that is very obviously not normal. The result is that F-distribution is roughly similar to our previous ones based on the normal distribution.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co"># an example bi-modal sample</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">levels</span>*<span class="no">n_per_level</span>/<span class="fl">2</span>,<span class="fl">0</span>,<span class="fl">1</span>),<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">levels</span>*<span class="no">n_per_level</span>/<span class="fl">2</span>,<span class="fl">5</span>,<span class="fl">1</span>))))</pre></body></html></div>
<p><img src="Lab5_ANOVA_Randomization_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><html><body><pre class="r">
<span class="no">save_bimodal_F_values</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fl">1000</span>)
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">1000</span>){

  <span class="no">random_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span>(<span class="kw">subjects</span> <span class="kw">=</span> <span class="fl">1</span>:(<span class="no">levels</span>*<span class="no">n_per_level</span>),
                        <span class="kw">IV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="no">levels</span>, <span class="kw">each</span> <span class="kw">=</span> <span class="no">n_per_level</span>)),
                        <span class="kw">DV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">levels</span>*<span class="no">n_per_level</span>/<span class="fl">2</span>,<span class="fl">0</span>,<span class="fl">1</span>),
                                      <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">levels</span>*<span class="no">n_per_level</span>/<span class="fl">2</span>,<span class="fl">5</span>,<span class="fl">1</span>)))
                        )
  <span class="no">aov.out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span>(<span class="no">DV</span> ~ <span class="no">IV</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">random_data</span>)
  <span class="no">simulated_F</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">aov.out</span>)<span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">`F value`</span>[<span class="fl">1</span>]
  <span class="no">save_bimodal_F_values</span>[<span class="no">i</span>] <span class="kw">&lt;-</span> <span class="no">simulated_F</span>
}

<span class="no">F_comparison</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"analytic"</span>,<span class="st">"sim_0_1"</span>,<span class="st">"sim_50_25"</span>, <span class="st">"sim_bimodal"</span>), <span class="kw">each</span> <span class="kw">=</span> <span class="fl">1000</span>),
                        <span class="kw">F_value</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">rf</a></span>(<span class="fl">1000</span>,<span class="fl">3</span>,<span class="fl">16</span>),<span class="no">save_F_values</span>, <span class="no">save_new_F_values</span>,<span class="no">save_bimodal_F_values</span>))

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">F_comparison</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">F_value</span>))+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span>(<span class="kw">bins</span><span class="kw">=</span><span class="fl">100</span>)+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~<span class="no">type</span>)</pre></body></html></div>
<p><img src="Lab5_ANOVA_Randomization_files/figure-html/unnamed-chunk-7-2.png" width="700"></p>
</div>
<div id="p-values" class="section level3">
<h3 class="hasAnchor">
<a href="#p-values" class="anchor"></a>p-values</h3>
<p>Let’s consider p-values for a moment. The graph above shows several simulations of the “ultimate control experiment” for our design. All of the <span class="math inline">\(F-values\)</span> are the values that can be obtained by chance alone. Remember, we introduce randomness by assigning different people randomly to different groups, and we assume there is inherent variability in our measurement that is also unpredictable.</p>
<p>Let’s be conventional for a moment and ask about the critical value of F, for an alpha of .05. This would be the value of F where 95% of F values are smaller than the critical value.</p>
<p>We can use the <code>qf</code> function to compute the critical value precisely:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">qf</a></span>(<span class="fl">.95</span>,<span class="fl">3</span>,<span class="fl">16</span>)
<span class="co">#&gt; [1] 3.238872</span></pre></body></html></div>
<p>Let’s see how close each of the simulations got to this critical value:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)

<span class="co">## 1000 deviates samples from true F distribution</span>
<span class="no">Fs</span> <span class="kw">&lt;-</span> <span class="no">F_comparison</span>[<span class="no">F_comparison</span>$<span class="no">type</span><span class="kw">==</span><span class="st">"analytic"</span>,]$<span class="no">F_value</span>
<span class="no">sorted_Fs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="no">Fs</span>)
<span class="no">sorted_Fs</span>[<span class="fl">950</span>]
<span class="co">#&gt; [1] 3.194495</span>

<span class="co">## 1000 deviates samples from normal sim_0_1</span>
<span class="no">Fs</span> <span class="kw">&lt;-</span> <span class="no">F_comparison</span>[<span class="no">F_comparison</span>$<span class="no">type</span><span class="kw">==</span><span class="st">"sim_0_1"</span>,]$<span class="no">F_value</span>
<span class="no">sorted_Fs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="no">Fs</span>)
<span class="no">sorted_Fs</span>[<span class="fl">950</span>]
<span class="co">#&gt; [1] 3.166004</span>

<span class="co">## 1000 deviates samples from normal sim_50_25</span>
<span class="no">Fs</span> <span class="kw">&lt;-</span> <span class="no">F_comparison</span>[<span class="no">F_comparison</span>$<span class="no">type</span><span class="kw">==</span><span class="st">"sim_50_25"</span>,]$<span class="no">F_value</span>
<span class="no">sorted_Fs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="no">Fs</span>)
<span class="no">sorted_Fs</span>[<span class="fl">950</span>]
<span class="co">#&gt; [1] 2.913236</span>

<span class="co">## 1000 deviates samples from bimodal sim</span>
<span class="no">Fs</span> <span class="kw">&lt;-</span> <span class="no">F_comparison</span>[<span class="no">F_comparison</span>$<span class="no">type</span><span class="kw">==</span><span class="st">"sim_bimodal"</span>,]$<span class="no">F_value</span>
<span class="no">sorted_Fs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="no">Fs</span>)
<span class="no">sorted_Fs</span>[<span class="fl">950</span>]
<span class="co">#&gt; [1] 3.657799</span></pre></body></html></div>
<p>Blurring your eyes a bit, we see that control experiments where the manipulation does nothing produce F values that are smaller than 3.2 to 3.4ish 95% of the time. Looking at the distributions, themselves, you can see that they never produce values much larger than 10.</p>
<p>If you were to conduct a real experiment, then you might want to observe an F value that was larger than 3.2ish. If you found an F-value larger than 10, you could be pretty confident that the null-distribution did not cause the F-value. Instead, it would seem more plausible that your experimental manipulation actually caused some change in the means of your measured variable.</p>
</div>
</div>
<div id="randomization-test" class="section level2">
<h2 class="hasAnchor">
<a href="#randomization-test" class="anchor"></a>Randomization test</h2>
<p>We have seen that the true F-distribution is well approximated by our simulation distributions, and that the F-distribution is robust to violations of the assumptions of ANOVA. For example, when we changed the base distribution to a bi-modal distribution, we found a pretty similar overall F-distribution to the ones obtained assuming a normal distribution.</p>
<p>More generally, we can construct useful null distributions for a one-factor design that do not depend on the distributional assumptions of ANOVA. For example, we could conduct a randomization test. The randomization test creates a null-distribution that controls for the random assignment process. For example, it is clear that when an experiment involves randomly assigning people to different groups, that the assignment that happened is just one out of many possible assignments to the groups. For example, if you assigned all the tall people to one group, all of the average height people to one group, and all of the shorter people to another group, would you really want to claim that some manipulation like listening to different kinds of music, caused people to have different heights? No, instead you would say the assignment process caused people of specific heights to be assigned to specific groups. The general question here is, given that the people you are measuring will be different, what kinds of differences between groups could you get just by assigning people randomly to different groups?</p>
<p>The randomization test determines the answer to the above question by taking the observed data, reshuffling it across the groups many times over, and each time computing a test statistic like <span class="math inline">\(F\)</span>. s</p>
<p>Imagine we had some data where one group had a larger mean than the others. I just made up some numbers here, so they definetly did not come from a normal distribution. Most of the numbers are around 9, but the numbers in group 1 happen to be all above 10.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">levels</span> <span class="kw">&lt;-</span> <span class="fl">4</span>
<span class="no">n_per_level</span> <span class="kw">&lt;-</span> <span class="fl">5</span>

<span class="no">some_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="kw">subjects</span> <span class="kw">=</span> <span class="fl">1</span>:(<span class="no">levels</span>*<span class="no">n_per_level</span>),
                      <span class="kw">IV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="no">levels</span>, <span class="kw">each</span> <span class="kw">=</span> <span class="no">n_per_level</span>)),
                      <span class="kw">DV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">11</span>,<span class="fl">12</span>,<span class="fl">11</span>,<span class="fl">11</span>,<span class="fl">12</span>,
                             <span class="fl">10</span>,<span class="fl">8</span>,<span class="fl">10</span>,<span class="fl">9</span>,<span class="fl">10</span>,
                             <span class="fl">8</span>,<span class="fl">9</span>,<span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">10</span>,
                             <span class="fl">10</span>,<span class="fl">8</span>,<span class="fl">10</span>,<span class="fl">9</span>,<span class="fl">10</span>
                             )
                      )</pre></body></html></div>
<p>Even though we are violating the assumptions of the ANOVA, we can still compute the ANOVA table from the data. Here, we get an <span class="math inline">\(F\)</span> value of 7.407. The p-value for this F-value assumes that the data were randomly sampled from a normal distribution, which they were not.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">aov.out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span>(<span class="no">DV</span> ~ <span class="no">IV</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">some_data</span>)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">aov.out</span>)
<span class="co">#&gt;             Df Sum Sq Mean Sq F value  Pr(&gt;F)   </span>
<span class="co">#&gt; IV           3   15.0   5.000   7.407 0.00249 **</span>
<span class="co">#&gt; Residuals   16   10.8   0.675                   </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></pre></body></html></div>
<p>Instead of using the provided p-value, we can conduct a randomization test. This involves shuffling the data, computing F, and repeating several times to create a sampling distribution of <span class="math inline">\(F\)</span>. This distribution will be specific to the numbers in the dataset. We are asking, what kind of <span class="math inline">\(F\)</span> values could have been obtained if the numbers for each person were randomly assigned to different groups.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">save_F_values</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fl">1000</span>)
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">1000</span>){
  <span class="no">some_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="kw">subjects</span> <span class="kw">=</span> <span class="fl">1</span>:(<span class="no">levels</span>*<span class="no">n_per_level</span>),
                        <span class="kw">IV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="no">levels</span>, <span class="kw">each</span> <span class="kw">=</span> <span class="no">n_per_level</span>)),
                        <span class="kw">DV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">11</span>,<span class="fl">12</span>,<span class="fl">11</span>,<span class="fl">11</span>,<span class="fl">12</span>,
                               <span class="fl">10</span>,<span class="fl">8</span>,<span class="fl">10</span>,<span class="fl">9</span>,<span class="fl">10</span>,
                               <span class="fl">8</span>,<span class="fl">9</span>,<span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">10</span>,
                               <span class="fl">10</span>,<span class="fl">8</span>,<span class="fl">10</span>,<span class="fl">9</span>,<span class="fl">10</span>
                               ))
                        )
  <span class="no">aov.out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span>(<span class="no">DV</span> ~ <span class="no">IV</span>, <span class="kw">data</span> <span class="kw">=</span><span class="no">some_data</span>)
  <span class="no">simulated_F</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">aov.out</span>)<span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">`F value`</span>[<span class="fl">1</span>]
  <span class="no">save_F_values</span>[<span class="no">i</span>] <span class="kw">&lt;-</span> <span class="no">simulated_F</span>
}

<span class="no">F_comparison</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"analytic"</span>,<span class="st">"randomization"</span>), <span class="kw">each</span> <span class="kw">=</span> <span class="fl">1000</span>),
                        <span class="kw">F_value</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">rf</a></span>(<span class="fl">1000</span>,<span class="fl">3</span>,<span class="fl">16</span>),<span class="no">save_F_values</span>))

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">F_comparison</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">F_value</span>))+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span>()+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~<span class="no">type</span>)</pre></body></html></div>
<p><img src="Lab5_ANOVA_Randomization_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>As you can see, the distribution of possible F values that we obtained by randomly reshuffling the data isn’t terribly different from the analytic F distribution based on the normal distribution.</p>
<p>Using the F distribution from the Randomization test, we can compute a p-value for the observed F-value and find a similar result.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">save_F_values</span>[<span class="no">save_F_values</span><span class="kw">&gt;</span><span class="fl">7.407</span>])/<span class="fl">1000</span>
<span class="co">#&gt; [1] 0.001</span></pre></body></html></div>
</div>
<div id="the-alternative-hypotheses" class="section level2">
<h2 class="hasAnchor">
<a href="#the-alternative-hypotheses" class="anchor"></a>The alternative hypotheses</h2>
<p>The above section showed an example of simulating the null-hypothesis for a design with one independent variable and multiple levels. The basic set-up was pretty straightforward. You randomly sample numbers from the same distribution into your different groups. Thus, the null hypothesis is that every group mean should be on average be the same, because they should all be the same as the mean of the distribution that they came from.</p>
<p>What if we want to simulate a situation where your experimental manipulation is presumed to actually do something to the measurement? If your manipulation causes some change in the measurement, then by definition we must be violating the <strong>iid</strong> assumption. It will no longer be the case that the scores sampled into different groups are taken randomly from identical distributions. Instead, we think of the manipulation as effectively causing multiple distributions to exist. If one level causes a large increase to the mean, then we think of the scores in that group as coming from a distribution with a shifted mean, relative to scores in the other groups.</p>
<div id="simulating-alternative-hypotheses" class="section level3">
<h3 class="hasAnchor">
<a href="#simulating-alternative-hypotheses" class="anchor"></a>Simulating alternative hypotheses</h3>
<p>The null-hypothesis is easy to simulate because of the <strong>iid</strong> assumption. However, alternative hypotheses in general are more difficult because there are an infinity of them.</p>
<p>Let’s begin by simulating one specific alternative hypothesis. The method for doing this is just to declare what distributions your data are being sampled from for each group. Any scenario that is not the null, is a possible alternative.</p>
<p>Let’s imagine that we are measuring performance on a standardized test, with mean = 100, and sd = 25. There are four groups that manipulate the kind of music people listen to when they take the test. Let’s say that for some reason listening to 1970s sitcom music causally changes test performance, and it increases the mean for that group by 1 one whole standard deviation. Let’s declare this exact situation in R.</p>
<p>The tibble represents random values for four groups sampled from two different distributions. Group one gets <code><a href="https://rdrr.io/r/stats/Normal.html">rnorm(n,125,25)</a></code>, and the other three groups get <code><a href="https://rdrr.io/r/stats/Normal.html">rnorm(n,100,25)</a></code>.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r">
<span class="no">levels</span> <span class="kw">&lt;-</span> <span class="fl">4</span>
<span class="no">n_per_level</span> <span class="kw">&lt;-</span> <span class="fl">5</span>

<span class="no">alternative_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="kw">subjects</span> <span class="kw">=</span> <span class="fl">1</span>:(<span class="no">levels</span>*<span class="no">n_per_level</span>),
                      <span class="kw">IV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="no">levels</span>, <span class="kw">each</span> <span class="kw">=</span> <span class="no">n_per_level</span>)),
                      <span class="kw">DV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fl">125</span>, <span class="fl">25</span>),
                             <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fl">100</span>, <span class="fl">25</span>),
                             <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fl">100</span>, <span class="fl">25</span>),
                             <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fl">100</span>, <span class="fl">25</span>)
                             )
                      )</pre></body></html></div>
<p>In general, we can specify any alternative hypothesis that we want. All we have to do is declare the properties of the distribution(s) generating the scores in each group.</p>
<p>We can even generate F-distributions based off of the alternative that we specified. For example, what kind of F-values would we expect to get for the above set of assumptions?</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="co"># repeat the above many times to compute the F-distribution</span>
<span class="no">save_altF_values</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fl">1000</span>)
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">1000</span>){
<span class="no">alternative_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="kw">subjects</span> <span class="kw">=</span> <span class="fl">1</span>:(<span class="no">levels</span>*<span class="no">n_per_level</span>),
                      <span class="kw">IV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="no">levels</span>, <span class="kw">each</span> <span class="kw">=</span> <span class="no">n_per_level</span>)),
                      <span class="kw">DV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fl">125</span>, <span class="fl">25</span>),
                             <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fl">100</span>, <span class="fl">25</span>),
                             <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fl">100</span>, <span class="fl">25</span>),
                             <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fl">100</span>, <span class="fl">25</span>)
                             )
                      )
<span class="no">aov.out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span>(<span class="no">DV</span> ~ <span class="no">IV</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">alternative_data</span>)
<span class="no">simulated_F</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">aov.out</span>)<span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">`F value`</span>[<span class="fl">1</span>]
<span class="no">save_altF_values</span>[<span class="no">i</span>] <span class="kw">&lt;-</span> <span class="no">simulated_F</span>
}

<span class="no">F_comparison</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"null"</span>,<span class="st">"alternative"</span>), <span class="kw">each</span> <span class="kw">=</span> <span class="fl">1000</span>),
                        <span class="kw">F_value</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">rf</a></span>(<span class="fl">1000</span>,<span class="fl">3</span>,<span class="fl">16</span>),<span class="no">save_altF_values</span>))

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">F_comparison</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">F_value</span>))+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span>(<span class="kw">bins</span><span class="kw">=</span><span class="fl">100</span>)+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~<span class="no">type</span>, <span class="kw">nrow</span><span class="kw">=</span><span class="fl">2</span>)</pre></body></html></div>
<p><img src="Lab5_ANOVA_Randomization_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>The alternative F-distribution is more spread out, and tends to have higher values than the null. But, there is still a good deal of overlap. For example, the critical value for F based on the null is</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">qf</a></span>(<span class="fl">.95</span>,<span class="fl">3</span>,<span class="fl">16</span>)
<span class="co">#&gt; [1] 3.238872</span></pre></body></html></div>
<p>How many times was F higher than 3.23 in the alternative distribution?</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">save_altF_values</span>[<span class="no">save_altF_values</span> <span class="kw">&gt;</span> <span class="fl">3.23</span>])
<span class="co">#&gt; [1] 262</span></pre></body></html></div>
<p>This is a pretty low number, and it means that the true effect is not detected very often even when it is actually there. In other words, the design has low power to detect to detect the effect.</p>
</div>
<div id="number-of-subjects-needed" class="section level3">
<h3 class="hasAnchor">
<a href="#number-of-subjects-needed" class="anchor"></a>Number of subjects needed</h3>
<p>We programmed one group to have a mean that was shifted by a whole standard deviation. This is a large difference, but it was not reliably detected by the design because of the large amount of variability stemming from the small n. Consider what happens here when we increase the number of subjects, say from 5 to 50 in each group:</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">n_per_level</span> <span class="kw">&lt;-</span> <span class="fl">50</span>

<span class="co"># repeat the above many times to compute the F-distribution</span>
<span class="no">save_altF_values</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fl">1000</span>)
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">1000</span>){
<span class="no">alternative_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="kw">subjects</span> <span class="kw">=</span> <span class="fl">1</span>:(<span class="no">levels</span>*<span class="no">n_per_level</span>),
                      <span class="kw">IV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="no">levels</span>, <span class="kw">each</span> <span class="kw">=</span> <span class="no">n_per_level</span>)),
                      <span class="kw">DV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fl">125</span>, <span class="fl">25</span>),
                             <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fl">100</span>, <span class="fl">25</span>),
                             <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fl">100</span>, <span class="fl">25</span>),
                             <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fl">100</span>, <span class="fl">25</span>)
                             )
                      )
<span class="no">aov.out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span>(<span class="no">DV</span> ~ <span class="no">IV</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">alternative_data</span>)
<span class="no">simulated_F</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">aov.out</span>)<span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">`F value`</span>[<span class="fl">1</span>]
<span class="no">save_altF_values</span>[<span class="no">i</span>] <span class="kw">&lt;-</span> <span class="no">simulated_F</span>
}

<span class="no">F_comparison</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"null"</span>,<span class="st">"alternative"</span>), <span class="kw">each</span> <span class="kw">=</span> <span class="fl">1000</span>),
                        <span class="kw">F_value</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">rf</a></span>(<span class="fl">1000</span>,<span class="fl">3</span>,<span class="fl">96</span>),<span class="no">save_altF_values</span>))

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">F_comparison</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">F_value</span>))+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span>(<span class="kw">bins</span><span class="kw">=</span><span class="fl">100</span>)+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~<span class="no">type</span>, <span class="kw">nrow</span><span class="kw">=</span><span class="fl">2</span>)</pre></body></html></div>
<p><img src="Lab5_ANOVA_Randomization_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>In this scenario the <span class="math inline">\(F\)</span> values in the alternative distribution are much higher than the null distribution, and reliably so. The critical value for F is slightly different now because increasing n changed the degrees of freedom. The new critical value is:</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">qf</a></span>(<span class="fl">.95</span>,<span class="fl">3</span>,<span class="fl">200</span>-<span class="fl">4</span>)
<span class="co">#&gt; [1] 2.650677</span></pre></body></html></div>
<p>Now, we can ask how many experiments out of 1000 surpassed the critical value?</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">save_altF_values</span>[<span class="no">save_altF_values</span> <span class="kw">&gt;</span> <span class="fl">2.65</span>])
<span class="co">#&gt; [1] 998</span></pre></body></html></div>
<p>In this case, the design is very sensitive, 100% of the experiments would have yielded an F-value larger than the critical value. From a cost-benefit perspective, increasing n to 50 for each group might be waste of resources. For example, what is the least amount of subjects you would need to have power of around 95%?</p>
<p>One solution is fidget with n until you find about 95%…</p>
<p>For example, I wiggled <code>n_per_level</code> until I was getting about 95% of experiments passing the critical value, and I landed on n = 25 per group. Note, that this simulation is a little noisy because we are only conducting 1000 simulations, we would get a more precise and stable estimate by increasing the number of simulations.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r">
<span class="no">n_per_level</span> <span class="kw">&lt;-</span> <span class="fl">25</span>

<span class="co"># repeat the above many times to compute the F-distribution</span>
<span class="no">save_altF_values</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fl">1000</span>)
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">1000</span>){
  <span class="no">alternative_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="kw">subjects</span> <span class="kw">=</span> <span class="fl">1</span>:(<span class="no">levels</span>*<span class="no">n_per_level</span>),
                        <span class="kw">IV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="no">levels</span>, <span class="kw">each</span> <span class="kw">=</span> <span class="no">n_per_level</span>)),
                        <span class="kw">DV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fl">125</span>, <span class="fl">25</span>),
                               <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fl">100</span>, <span class="fl">25</span>),
                               <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fl">100</span>, <span class="fl">25</span>),
                               <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fl">100</span>, <span class="fl">25</span>)
                               )
                        )
  <span class="no">aov.out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span>(<span class="no">DV</span> ~ <span class="no">IV</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">alternative_data</span>)
  <span class="no">simulated_F</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">aov.out</span>)<span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">`F value`</span>[<span class="fl">1</span>]
  <span class="no">save_altF_values</span>[<span class="no">i</span>] <span class="kw">&lt;-</span> <span class="no">simulated_F</span>
}

<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">save_altF_values</span>[<span class="no">save_altF_values</span> <span class="kw">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">qf</a></span>(<span class="fl">.95</span>,<span class="fl">3</span>,(<span class="no">n_per_level</span>*<span class="fl">4</span>)-<span class="fl">4</span>)])/<span class="fl">1000</span>
<span class="co">#&gt; [1] 0.955</span></pre></body></html></div>
<p>Instead of wiggling the n by hand, we could run a set of simulations for different n, and plot a curve power-curve:</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r">
<span class="no">num_subjects</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">5</span>,<span class="fl">10</span>,<span class="fl">15</span>,<span class="fl">20</span>,<span class="fl">25</span>,<span class="fl">30</span>)
<span class="no">sim_power</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">num_subjects</span>))

<span class="kw">for</span>(<span class="no">n</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">num_subjects</span>)){

  <span class="no">n_per_level</span> <span class="kw">&lt;-</span> <span class="no">num_subjects</span>[<span class="no">n</span>]

  <span class="co"># repeat the above many times to compute the F-distribution</span>
  <span class="no">save_altF_values</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fl">1000</span>)
  <span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">1000</span>){
    <span class="no">alternative_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="kw">subjects</span> <span class="kw">=</span> <span class="fl">1</span>:(<span class="no">levels</span>*<span class="no">n_per_level</span>),
                          <span class="kw">IV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="no">levels</span>, <span class="kw">each</span> <span class="kw">=</span> <span class="no">n_per_level</span>)),
                          <span class="kw">DV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fl">125</span>, <span class="fl">25</span>),
                                 <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fl">100</span>, <span class="fl">25</span>),
                                 <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fl">100</span>, <span class="fl">25</span>),
                                 <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fl">100</span>, <span class="fl">25</span>)
                                 )
                          )
    <span class="no">aov.out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span>(<span class="no">DV</span> ~ <span class="no">IV</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">alternative_data</span>)
    <span class="no">simulated_F</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">aov.out</span>)<span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">`F value`</span>[<span class="fl">1</span>]
    <span class="no">save_altF_values</span>[<span class="no">i</span>] <span class="kw">&lt;-</span> <span class="no">simulated_F</span>
  }

  <span class="no">power</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">save_altF_values</span>[<span class="no">save_altF_values</span> <span class="kw">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">qf</a></span>(<span class="fl">.95</span>,<span class="fl">3</span>,(<span class="no">n_per_level</span>*<span class="fl">4</span>)-<span class="fl">4</span>)])/<span class="fl">1000</span>
  <span class="no">sim_power</span>[<span class="no">n</span>] <span class="kw">&lt;-</span> <span class="no">power</span>
}

<span class="no">power_curve</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="no">num_subjects</span>,
                      <span class="no">sim_power</span>)

<span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="no">power_curve</span>)</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">num_subjects</th>
<th align="right">sim_power</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">5</td>
<td align="right">0.259</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">0.575</td>
</tr>
<tr class="odd">
<td align="right">15</td>
<td align="right">0.789</td>
</tr>
<tr class="even">
<td align="right">20</td>
<td align="right">0.893</td>
</tr>
<tr class="odd">
<td align="right">25</td>
<td align="right">0.961</td>
</tr>
<tr class="even">
<td align="right">30</td>
<td align="right">0.982</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb23"><html><body><pre class="r">
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">power_curve</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">num_subjects</span>,
                        <span class="kw">y</span><span class="kw">=</span><span class="no">sim_power</span>))+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>()+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>()</pre></body></html></div>
<p><img src="Lab5_ANOVA_Randomization_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
</div>
<div id="simulated-power-analysis" class="section level3">
<h3 class="hasAnchor">
<a href="#simulated-power-analysis" class="anchor"></a>Simulated power analysis</h3>
<p>Last semester we discussed power analysis for simple two-group designs along with the concept of effect-size. In those designs, we used Cohen’s D as a measure of effect-size, which expresses the mean difference between groups in terms of standard deviation units. There are several ways to generalize these ideas to one-factor ANOVA, where there are more than two groups.</p>
<p>Notice that in the above example, we didn’t discuss a general measure of effect-size before doing the power-analysis. Instead, we declared that one group would have a different mean than the other groups, and we also set the size of the difference to be one standard deviation. This approach is useful because it allows you, the researcher, to declare specifically what you think might happen in your experiment, and then conduct a simulation based power analysis to determine a sufficient sample-size to detect the effects that you specified. This is more or less in line with <span class="citation"><a href="#ref-lenthPracticalGuidelinesEffective2001" role="doc-biblioref">Lenth</a> (<a href="#ref-lenthPracticalGuidelinesEffective2001" role="doc-biblioref">2001</a>)</span>, who advocates for a thoughtful and tailored (to the research question at hand) approach to the problem of power analysis and sample-size planning.</p>
<p>Let’s consider one more example of a simulated power-analysis for a more general kind of question. Assume you a researcher studying performance on a standardized test that is normally distributed. You are interested in manipulations that help people learn the material that is being tested, and subsequently improve their test scores. You are going to run an experiment with 4 groups, and each group will get different learning interventions. You don’t know anything about whether the learning interventions will do anything. You have no idea what “effect” they will have on the test scores. Can you do a power analysis here, even when you have no idea could happen?…for example, consider that any of the four different interventions could cause mean test performance to go up or down by any amount…and, since the groups are independent, you could potentially find any combination of the possible ways that four group means could be different!</p>
<p>In this case, let’s say you are interested in practical matters like whether or not to actually use a particular learning intervention to help students. In this stage of the research you are trying different learning interventions out to see if any of them work. You are trying four different ones at a time. A good practical question is, what kind of learning intervention is worth using? Is a learning intervention that changes test performance by .00000001 of a standard deviation worth discovering? Perhaps not for the purposes of training students. What size of a difference is worth it?</p>
<p>Let’s say you would be interested in sdetecting evidence of manipulations that caused test performance to go up or down by around .2 standard deviations on average. I’m pulling this number out of the air as if it is meaningful, but perhaps it’s a big enough shift to be interesting. How many subjects are needed for reasonably powered design, let’s say power = 80%?</p>
<p>We can implement this situation by changing the mean value for each group. In this case, I sample the mean parameter from another normal distribution with mean = 0 and sd = .2. This results in the data from each group being sampled from different normal distributions that on average have mean differences of about .2 standard deviations in any direction.</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">num_subjects</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">75</span>, <span class="fl">100</span>, <span class="fl">125</span>, <span class="fl">150</span>, <span class="fl">175</span>, <span class="fl">200</span>)
<span class="no">sim_power</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">num_subjects</span>))

<span class="kw">for</span>(<span class="no">n</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">num_subjects</span>)){

  <span class="no">n_per_level</span> <span class="kw">&lt;-</span> <span class="no">num_subjects</span>[<span class="no">n</span>]

  <span class="co"># repeat the above many times to compute the F-distribution</span>
  <span class="no">save_altF_values</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fl">1000</span>)
  <span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">1000</span>){
    <span class="no">alternative_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="kw">subjects</span> <span class="kw">=</span> <span class="fl">1</span>:(<span class="no">levels</span>*<span class="no">n_per_level</span>),
                          <span class="kw">IV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="no">levels</span>, <span class="kw">each</span> <span class="kw">=</span> <span class="no">n_per_level</span>)),
                          <span class="kw">DV</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">.2</span>), <span class="fl">1</span>),
                                 <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">.2</span>), <span class="fl">1</span>),
                                 <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">.2</span>), <span class="fl">1</span>),
                                 <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">n_per_level</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">.2</span>), <span class="fl">1</span>)
                                 )
                          )
    <span class="no">aov.out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span>(<span class="no">DV</span> ~ <span class="no">IV</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">alternative_data</span>)
    <span class="no">simulated_F</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">aov.out</span>)<span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">`F value`</span>[<span class="fl">1</span>]
    <span class="no">save_altF_values</span>[<span class="no">i</span>] <span class="kw">&lt;-</span> <span class="no">simulated_F</span>
  }

  <span class="no">power</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">save_altF_values</span>[<span class="no">save_altF_values</span> <span class="kw">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">qf</a></span>(<span class="fl">.95</span>,<span class="fl">3</span>,(<span class="no">n_per_level</span>*<span class="fl">4</span>)-<span class="fl">4</span>)])/<span class="fl">1000</span>
  <span class="no">sim_power</span>[<span class="no">n</span>] <span class="kw">&lt;-</span> <span class="no">power</span>
}

<span class="no">power_curve</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="no">num_subjects</span>,
                      <span class="no">sim_power</span>)

<span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="no">power_curve</span>)</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="right">num_subjects</th>
<th align="right">sim_power</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">10</td>
<td align="right">0.133</td>
</tr>
<tr class="even">
<td align="right">50</td>
<td align="right">0.444</td>
</tr>
<tr class="odd">
<td align="right">75</td>
<td align="right">0.561</td>
</tr>
<tr class="even">
<td align="right">100</td>
<td align="right">0.651</td>
</tr>
<tr class="odd">
<td align="right">125</td>
<td align="right">0.725</td>
</tr>
<tr class="even">
<td align="right">150</td>
<td align="right">0.755</td>
</tr>
<tr class="odd">
<td align="right">175</td>
<td align="right">0.803</td>
</tr>
<tr class="even">
<td align="right">200</td>
<td align="right">0.852</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb25"><html><body><pre class="r">
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">power_curve</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">num_subjects</span>,
                        <span class="kw">y</span><span class="kw">=</span><span class="no">sim_power</span>))+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>()+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>()</pre></body></html></div>
<p><img src="Lab5_ANOVA_Randomization_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
</div>
</div>
<div id="lab-5-generalization-assignment" class="section level2">
<h2 class="hasAnchor">
<a href="#lab-5-generalization-assignment" class="anchor"></a>Lab 5 Generalization Assignment</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/btX3h8y-6IQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<div id="instructions" class="section level3">
<h3 class="hasAnchor">
<a href="#instructions" class="anchor"></a>Instructions</h3>
<p>Your assignment instructions are the following:</p>
<ol style="list-style-type: decimal">
<li>Work inside the new R project for stats II that you created</li>
<li>Create a new R Markdown document called “Lab5.Rmd”</li>
<li>Use Lab5.Rmd to show your work attempting to solve the following generalization problems. Commit your work regularly so that it appears on your Github repository.</li>
<li>
<strong>For each problem, make a note about how much of the problem you believe you can solve independently without help</strong>. For example, if you needed to watch the help video and are unable to solve the problem on your own without copying the answers, then your note would be 0. If you are confident you can complete the problem from scratch completely on your own, your note would be 100. It is OK to have all 0s or 100s anything in between.</li>
<li>Submit your github repository link for Lab 5 on blackboard.</li>
</ol>
</div>
<div id="problems" class="section level3">
<h3 class="hasAnchor">
<a href="#problems" class="anchor"></a>Problems</h3>
<p>In the context of making decisions about whether or not observed data is consistent or inconsistent with a Null hypothesis, it is possible to make errors. The questions below ask you to create simulated data containing patterns that could lead to correct and incorrect decisions about the role of the null hypothesis.</p>
<p>Consider a design with 3 groups, and 10 people per group. Assume that the dependent variable is assumed to be normally distributed, and use unit normal distributions with mean = 0, and sd = 1 in your simulations.</p>
<ol style="list-style-type: decimal">
<li><p>Create simulated data for the above design that could be produced by the null hypothesis, and that results in a <span class="math inline">\(F\)</span> value that is <strong>smaller</strong> than the critical value for <span class="math inline">\(F\)</span> in this design (assume alpha = .05). Report the ANOVA, and show a ggplot of the means in the simulated data. Furthermore, display the individual data points on top of the means. Would you reject the null hypothesis in this situation, and would you be incorrect or correct in rejecting the null? (3 points)</p></li>
<li><p>Create simulated data for the above design that could be produced by the null hypothesis, and that results in a <span class="math inline">\(F\)</span> value that is <strong>larger</strong> than the critical value for <span class="math inline">\(F\)</span> in this design (assume alpha = .05). Report the ANOVA, and show a ggplot of the means in the simulated data. Furthermore, display the individual data points on top of the means. Would you reject the null hypothesis in this situation, and would you be incorrect or correct in rejecting the null? (3 points)</p></li>
</ol>
<p>Bonus Question</p>
<ol start="3" style="list-style-type: decimal">
<li>In the lab we saw that F-distribution is robust to violations of the assumptions of ANOVA. For example, the simulation of the null based on a bi-modal distribution was very similar to the true F distribution. For this bonus question, show that you can “break” the F-distribution. Specifically, can you run a simulation that samples numbers from a non-normal distribution that does produce a very different looking F-distribution? (3 points)</li>
</ol>
<!--
## Extra

More simulations to break the ANOVA

Simulated Normal


```r
levels <- 4
n_per_level <- 5

save_F_values <- length(10000)

for(i in 1:10000){
  
  random_data <- tibble(subjects = 1:(levels*n_per_level),
                        IV = as.factor(rep(1:levels, each = n_per_level)),
                        DV = rnorm(levels*n_per_level, 0, 1)
                        )
  
  aov.out <- aov(DV ~ IV, data = random_data)
  
  simulated_F <- summary(aov.out)[[1]]$`F value`[1]
  
  save_F_values[i] <- simulated_F
}

F_comparison <- tibble(type = rep(c("analytic","sim_normal"), each = 10000), 
                       F_value = c(rf(10000,3,16),
                                   save_F_values))

ggplot(F_comparison, aes(x=F_value, color=type))+
  geom_freqpoly(bins=100)
```

<img src="Lab5_ANOVA_Randomization_files/figure-html/unnamed-chunk-24-1.png" width="700" />



Simulated Poisson



```r

levels <- 4
n_per_level <- 100

save_F_values <- length(10000)

for(i in 1:10000){
  
  random_data <- tibble(subjects = 1:(levels*n_per_level),
                        IV = as.factor(rep(1:levels, each = n_per_level)),
                        DV = rpois(levels*n_per_level, .1)
                        )
  
  save_F_values[i] <- summary(aov(DV ~ IV, data = random_data))[[1]]$`F value`[1]
  
}

F_comparison <- tibble(type = rep(c("analytic","sim_pois"), each = 10000), 
                       F_value = c(rf(10000,levels-1,(n_per_level*levels)-levels),
                                   save_F_values))

ggplot(F_comparison, aes(x=F_value, color=type))+
  geom_freqpoly(bins=100)
```

<img src="Lab5_ANOVA_Randomization_files/figure-html/unnamed-chunk-25-1.png" width="700" />



```r

levels <- 4
n_per_level <- 100

save_F_values <- length(10000)

for(i in 1:10000){
  
  random_data <- tibble(subjects = 1:(levels*n_per_level),
                        IV = as.factor(rep(1:levels, each = n_per_level)),
                        DV = rt(levels*n_per_level, 1)
                        )
  
  save_F_values[i] <- summary(aov(DV ~ IV, data = random_data))[[1]]$`F value`[1]
  
}

F_comparison <- tibble(type = rep(c("analytic","sim_cauchy"), each = 10000), 
                       F_value = c(rf(10000,levels-1,(n_per_level*levels)-levels),
                                   save_F_values))

ggplot(F_comparison, aes(x=F_value, color=type))+
  geom_freqpoly(bins=100)
```

<img src="Lab5_ANOVA_Randomization_files/figure-html/unnamed-chunk-26-1.png" width="700" />

-->
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-abdiExperimentalDesignAnalysis2009" class="csl-entry">
Abdi, H., Edelman, B., Dowling, W. J., &amp; Valentin, D. (2009). <em>Experimental design and analysis for psychology</em>. <span>Oxford University Press</span>.
</div>
<div id="ref-lenthPracticalGuidelinesEffective2001" class="csl-entry">
Lenth, R. V. (2001). Some <span>Practical Guidelines</span> for <span>Effective Sample Size Determination</span>. <em>The American Statistician</em>, <em>55</em>(3), 187–193. <a href="https://doi.org/b4523s">https://doi.org/b4523s</a>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://crumplab.github.io">Matthew Crump</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
